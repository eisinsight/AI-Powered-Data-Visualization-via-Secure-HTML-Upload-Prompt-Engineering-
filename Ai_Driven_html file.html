<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neumorphic Sales Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #F0F0F0;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    input[type="file"] {
      display: block;
      margin: 0 auto 40px auto;
      padding: 10px;
      border-radius: 12px;
      background: #F0F0F0;
      box-shadow: inset 4px 4px 8px #d1d1d1, inset -4px -4px 8px #ffffff;
      border: none;
      cursor: pointer;
    }
    #dashboard {
      padding: 20px;
      border-radius: 20px;
      background-color: #F0F0F0;
      box-shadow: 8px 8px 16px #d1d1d1, -8px -8px 16px #ffffff;
      position: relative;
      z-index: 1;
    }
    .suptitle {
      text-align: center;
      font-size: 20px;
      color: #555;
      margin-bottom: 5px;
      letter-spacing: 1px;
      font-weight: 500;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 32px;
    }
    .row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }
    .chart {
      flex: 1 1 40%;
      min-width: 300px;
      margin: 20px;
      padding: 20px;
      background-color: #F0F0F0;
      border-radius: 20px;
      box-shadow: 8px 8px 16px #d1d1d1, -8px -8px 16px #ffffff;
    }
    .centered {
      width: 60%;
      margin: 20px auto;
    }
    #captureBtn {
      display: block;
      margin: 20px auto 60px auto;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 50px;
      background-color: #F0F0F0;
      box-shadow: 4px 4px 8px #d1d1d1, -4px -4px 8px #ffffff;
      border: none;
      color: #333;
      cursor: pointer;
      transition: box-shadow 0.3s ease;
    }
    #captureBtn:hover {
      box-shadow: inset 4px 4px 8px #d1d1d1, inset -4px -4px 8px #ffffff;
    }
  </style>
</head>
<body>
  <input type="file" id="fileInput" accept=".json" />

  <div id="dashboard">
    <h1>ðŸ“Š Sales Dashboard</h1>

    <div class="row">
      <div id="regionProfit" class="chart"></div>
      <div id="channelPerformance" class="chart"></div>
    </div>
    <div class="row">
      <div id="productProfit" class="chart"></div>
      <div id="paymentTrends" class="chart"></div>
    </div>
    <div id="timeTrends" class="chart centered"></div>
  </div>

  <button id="captureBtn">ðŸ“¸ Download Dashboard as PNG</button>

  <script>
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const data = JSON.parse(event.target.result);
        renderDashboard(data);
      };
      reader.readAsText(file);
    });

    function renderDashboard(data) {
      const regions = [...new Set(data.map(d => d.Region))];
      const products = [...new Set(data.map(d => d.Product))];
      const channels = [...new Set(data.map(d => d.Sales_Channel))];
      const methods = [...new Set(data.map(d => d.Payment_Method))];
      const dates = [...new Set(data.map(d => d.Order_Date))];

      const regionProfit = regions.map(region => {
        const filtered = data.filter(d => d.Region === region);
        return filtered.reduce((sum, d) => sum + d.Profit, 0);
      });
      Plotly.newPlot('regionProfit', [{
        x: regions,
        y: regionProfit,
        type: 'bar',
        marker: { color: '#00796b' }
      }], { title: 'Profitability by Region', font: { color: '#333' } });

      const channelRevenue = channels.map(channel => {
        const filtered = data.filter(d => d.Sales_Channel === channel);
        return filtered.reduce((sum, d) => sum + d.Total_Revenue, 0);
      });
      Plotly.newPlot('channelPerformance', [{
        labels: channels,
        values: channelRevenue,
        type: 'pie'
      }], { title: 'Sales Channel Revenue Distribution', font: { color: '#333' } });

      const productProfit = products.map(product => {
        const filtered = data.filter(d => d.Product === product);
        return filtered.reduce((sum, d) => sum + d.Profit, 0);
      });
      Plotly.newPlot('productProfit', [{
        x: products,
        y: productProfit,
        type: 'bar',
        marker: { color: '#0288d1' }
      }], { title: 'Profit by Product', font: { color: '#333' } });

      const methodCount = methods.map(method => {
        return data.filter(d => d.Payment_Method === method).length;
      });
      Plotly.newPlot('paymentTrends', [{
        x: methods,
        y: methodCount,
        type: 'bar',
        marker: { color: '#c2185b' }
      }], { title: 'Payment Method Usage', font: { color: '#333' } });

      const dateRevenue = dates.map(date => {
        const filtered = data.filter(d => d.Order_Date === date);
        return filtered.reduce((sum, d) => sum + d.Total_Revenue, 0);
      });
      const dateProfit = dates.map(date => {
        const filtered = data.filter(d => d.Order_Date === date);
        return filtered.reduce((sum, d) => sum + d.Profit, 0);
      });
      Plotly.newPlot('timeTrends', [
        {
          x: dates,
          y: dateRevenue,
          name: 'Revenue',
          type: 'scatter',
          mode: 'lines+markers',
          line: { color: '#1976d2' }
        },
        {
          x: dates,
          y: dateProfit,
          name: 'Profit',
          type: 'scatter',
          mode: 'lines+markers',
          line: { color: '#d32f2f' }
        }
      ], { title: 'Revenue & Profit Over Time', font: { color: '#333' } });
    }

    document.getElementById('captureBtn').addEventListener('click', () => {
      setTimeout(() => {
        html2canvas(document.getElementById('dashboard'), {
          useCORS: true,
          allowTaint: true,
          backgroundColor: null,
          scale: 2
        }).then(canvas => {
          const link = document.createElement('a');
          link.download = 'Neumorphic_Sales_Dashboard.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
        });
      }, 1000);
    });
  </script>
</body>
</html>